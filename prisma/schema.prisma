// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id        String     @id @default(cuid())
  email     String     @unique
  password  String?
  name      String?
  role      String     @default("uploader") // "uploader" or "reviewer"
  createdAt DateTime   @default(now())
  uploads   Upload[]
  auditLogs AuditLog[]
}

model Upload {
  id         String     @id @default(cuid())
  userId     String
  user       User       @relation(fields: [userId], references: [id])
  filename   String
  status     String     @default("uploaded") // "uploaded", "reviewed", "processed"
  reviewedAt DateTime?
  comments   String?    // Reviewer's comments
  reviewedData String?  // JSON string of reviewed invoice data
  uploadedAt DateTime   @default(now())
  auditLogs  AuditLog[]
}

model AuditLog {
  id          String   @id @default(cuid())
  userId      String?
  user        User?    @relation(fields: [userId], references: [id])
  uploadId    String?
  upload      Upload?  @relation(fields: [uploadId], references: [id])
  action      String   // 'upload_created', 'upload_reviewed', 'upload_downloaded', etc.
  details     String?  // JSON string with additional details
  ipAddress   String?
  userAgent   String?
  createdAt   DateTime @default(now())

  @@map("audit_logs")
}

model Settings {
  id             String   @id @default(cuid())
  uploaderEmail  String   @default("anissa@example.com") @map("uploaderemail")
  reviewerEmail  String   @default("reviewer@example.com") @map("revieweremail")
  updatedAt      DateTime @updatedAt @map("updatedat")

  @@map("settings")
}
